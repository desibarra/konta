{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load humanize %} {# IMPORTANTE #}

{% block content %}
<div class="container-fluid mt-4">
    <h2 class="mb-4">Balanza de Comprobación</h2>
    <div class="card mb-3 shadow-sm">
        <div class="card-body p-3">
            <form method="get" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label fw-bold">Fecha Inicio</label>
                    <input type="date" class="form-control" name="fecha_inicio" value="{{ fecha_inicio }}">
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-bold">Fecha Fin</label>
                    <input type="date" class="form-control" name="fecha_fin" value="{{ fecha_fin }}">
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">Filtrar</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="table-responsive">
            <table class="table table-striped table-hover table-sm mb-0 align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Código</th>
                        <th>Cuenta</th>
                        <th class="text-end">Saldo Inicial</th>
                        <th class="text-end">Mov. Debe</th>
                        <th class="text-end">Mov. Haber</th>
                        <th class="text-end">Saldo Final</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cuenta in cuentas %}
                    {# Determinar clases según nivel: nivel1 -> mayor (negrita + fondo), nivel2 -> subcuenta (indent), nivel3 -> auxiliar (más indent) #}
                    {% if cuenta.nivel == 1 %}
                    <tr class="table-secondary fw-bold">
                        <td>{{ cuenta.codigo }}</td>
                        <td class="fw-bold">{{ cuenta.nombre }}</td>
                        <td class="text-end font-monospace">{{ cuenta.saldo_inicial|floatformat:2|intcomma }}</td>
                        <td class="text-end font-monospace text-primary">{{ cuenta.movimientos_debe|floatformat:2|intcomma }}</td>
                        <td class="text-end font-monospace text-primary">{{ cuenta.movimientos_haber|floatformat:2|intcomma }}</td>
                        <td class="text-end font-monospace fw-bold">{{ cuenta.saldo_final|floatformat:2|intcomma }}</td>
                    </tr>
                    {% elif cuenta.nivel == 2 %}
                    <tr>
                        <td>{{ cuenta.codigo }}</td>
                        <td class="ps-4">{{ cuenta.nombre }}</td>
                        <td class="text-end font-monospace">{{ cuenta.saldo_inicial|floatformat:2|intcomma }}</td>
                        <td class="text-end font-monospace text-primary">{{ cuenta.movimientos_debe|floatformat:2|intcomma }}</td>
                        <td class="text-end font-monospace text-primary">{{ cuenta.movimientos_haber|floatformat:2|intcomma }}</td>
                        <td class="text-end font-monospace fw-bold">{{ cuenta.saldo_final|floatformat:2|intcomma }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td>{{ cuenta.codigo }}</td>
                        <td class="ps-5">{{ cuenta.nombre }}</td>
                        <td class="text-end font-monospace">{{ cuenta.saldo_inicial|floatformat:2|intcomma }}</td>
                        <td class="text-end font-monospace text-primary">{{ cuenta.movimientos_debe|floatformat:2|intcomma }}</td>
                        <td class="text-end font-monospace text-primary">{{ cuenta.movimientos_haber|floatformat:2|intcomma }}</td>
                        <td class="text-end font-monospace fw-bold">{{ cuenta.saldo_final|floatformat:2|intcomma }}</td>
                    </tr>
                    {% endif %}
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center text-muted py-3">Sin movimientos.</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="table-light fw-bold">
                    <tr>
                        <td colspan="3" class="text-end">Totales Control:</td>
                        <td
                            class="text-end font-monospace {% if total_debe != total_haber %}bg-danger text-white{% endif %}">
                            {{ total_debe|floatformat:2|intcomma }}</td>
                        <td
                            class="text-end font-monospace {% if total_debe != total_haber %}bg-danger text-white{% endif %}">
                            {{ total_haber|floatformat:2|intcomma }}</td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
{% endblock %}