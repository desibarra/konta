{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load humanize %} {# IMPORTANTE #}

{% block content %}
<div class="container-fluid mt-4">
    <h2 class="mb-4">Balanza de Comprobaci√≥n</h2>
    <div class="card mb-3 shadow-sm">
        <div class="card-body p-3">
            <form method="get" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label fw-bold">Fecha Inicio</label>
                    <input type="date" class="form-control" name="fecha_inicio" value="{{ fecha_inicio }}">
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-bold">Fecha Fin</label>
                    <input type="date" class="form-control" name="fecha_fin" value="{{ fecha_fin }}">
                </div>
                <div class="col-md-2 d-flex gap-2">
                    <button type="submit" class="btn btn-primary w-50">Filtrar</button>

                    <div class="btn-group w-50">
                        <button type="button" class="btn btn-outline-secondary dropdown-toggle w-100"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Exportar
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <a class="dropdown-item" target="_blank"
                                    href="{% url 'cumplimiento_sat_download' %}?doc=balanza&fmt=pdf&fecha_inicio={{ fecha_inicio }}&fecha_fin={{ fecha_fin }}">üìÑ
                                    PDF (Imprimir)</a>
                            </li>
                            <li>
                                <a class="dropdown-item" target="_blank"
                                    href="{% url 'cumplimiento_sat_download' %}?doc=balanza&fmt=xlsx&fecha_inicio={{ fecha_inicio }}&fecha_fin={{ fecha_fin }}">üìä
                                    Excel (XLSX)</a>
                            </li>
                            <li>
                                <a class="dropdown-item" target="_blank"
                                    href="{% url 'cumplimiento_sat_download' %}?doc=balanza&fmt=xml&fecha_inicio={{ fecha_inicio }}&fecha_fin={{ fecha_fin }}">üèõÔ∏è
                                    XML SAT (Anexo 24)</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="table-responsive">
            <table class="table table-striped table-hover table-sm mb-0 align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>C√≥digo</th>
                        <th>Cuenta</th>
                        <th class="text-end">Saldo Inicial</th>
                        <th class="text-end">Debe</th>
                        <th class="text-end">Haber</th>
                        <th class="text-end">Saldo Final</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cuenta in cuentas %}
                    <tr>
                        <td>
                            <a style="color: blue !important; text-decoration: underline !important;"
                                href="{% url 'reporte_auxiliares' %}?cuenta_id={{ cuenta.id }}&fecha_inicio={{ fecha_inicio }}&fecha_fin={{ fecha_fin }}">
                                {{ cuenta.codigo }}
                            </a>
                        </td>
                        <td>{{ cuenta.nombre }}</td>
                        <td class="text-end">{{ cuenta.saldo_inicial|floatformat:2|intcomma }}</td>
                        <td class="text-end">{{ cuenta.movimientos_debe|floatformat:2|intcomma }}</td>
                        <td class="text-end">{{ cuenta.movimientos_haber|floatformat:2|intcomma }}</td>
                        <td class="text-end">{{ cuenta.saldo_final|floatformat:2|intcomma }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="table-light fw-bold">
                    <tr style="background-color: #f8f9fa; border-top: 2px solid #dee2e6;">
                        <td colspan="3" class="text-end">Totales Control:</td>
                        <td
                            class="text-end font-monospace {% if total_debe != total_haber %}bg-danger text-white{% endif %}">
                            {{ total_debe|floatformat:2|intcomma }}</td>
                        <td
                            class="text-end font-monospace {% if total_debe != total_haber %}bg-danger text-white{% endif %}">
                            {{ total_haber|floatformat:2|intcomma }}</td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
{% endblock %}